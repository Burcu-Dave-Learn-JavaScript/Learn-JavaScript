<!DOCTYPE html >
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Practical JavaScript</title>
</head>
<body>
  <h1>Todo List</h1>
  <div>
    <button onclick="handlers.toggleAll()">Toggle All</button>
  </div>
  <div>
    <button onclick="handlers.addTodo()">Add</button>
    <input type="text" id="addTodoTextInput"/>
  </div>

  <div> 
    <button onclick="handlers.changeTodo()">Change Todo</button>
    <input id="changeTodoPositionInput" type="number"/>
    <input id="changeTodoTextInput" type="text"/>
  </div>

  <div> 
    <button onclick="handlers.toggleCompleted()">Toggle Completed</button>
    <input id="toggleCompletedPositionInput" type="number"/>
  </div>

  <ul>

  </ul>

  <script>
      var todoList = {
        todos: [],
        addTodo: function(todoText){
          this.todos.push({
            todoText: todoText,
            completed: false
          });
        },
        changeTodo: function(index, newTodoText){
          this.todos[index].todoText = newTodoText;
        },
        deleteTodo: function(index){
          this.todos.splice(index,1);
        },
        toggleCompleted: function(index){
          var todo = this.todos[index];
          todo.completed = !todo.completed;
        },
        toggleAll: function(){
          var totalTodos = this.todos.length;
          var completedTodos = 0;

          this.todos.forEach(function(todo){
            if (todo.completed === true)
            {
              completedTodos++;
            }
          });

          // if everything true - make everything false
          if(completedTodos === totalTodos)
          {
            this.todos.forEach(function(todo){
              todo.completed = false;
            });
          }
          else // make everything true
          {
            this.todos.forEach(function(todo){
              todo.completed = true;
            });
          }
        }

      };

      var handlers = {
        addTodo: function(){
          var addTodoTextInput = document.getElementById('addTodoTextInput');
          todoList.addTodo(addTodoTextInput.value);
          addTodoTextInput.value = '';
          view.displayTodos();
        },
        changeTodo: function(){
          var changeTodoPositionInput = document.getElementById('changeTodoPositionInput');
          var changeTodoTextInput = document.getElementById('changeTodoTextInput');
          todoList.changeTodo(changeTodoPositionInput.valueAsNumber, changeTodoTextInput.value);
          changeTodoPositionInput.value = '';
          changeTodoTextInput = '';
          view.displayTodos();
        },
        deleteTodo: function(index){
          todoList.deleteTodo(index);
          view.displayTodos();
        },
        toggleCompleted: function(){
          var toggleCompletedPositionInput = document.getElementById('toggleCompletedPositionInput');
          todoList.toggleCompleted(toggleCompletedPositionInput.valueAsNumber);
          toggleCompletedPositionInput.value = '';
          view.displayTodos();
        },
        toggleAll: function(){
          todoList.toggleAll();
          view.displayTodos();
        }
      };

      var view = {
        displayTodos: function(){
          var todosUl = document.querySelector('ul');
          todosUl.innerHTML = '';
          for(var i =0; i < todoList.todos.length; i++)
          {
            var todoLi = document.createElement('li');
            var todo = todoList.todos[i];
            var todoTextWithCompletion = '';
            
            if (todo.completed === true){
              todoTextWithCompletion = '(x) ' + todo.todoText;
            }
            else{
              todoTextWithCompletion = '( ) ' + todo.todoText;
            }

            todoLi.id = i;
            todoLi.textContent = todoTextWithCompletion;
            todoLi.appendChild(this.createDeleteButton());
            todosUl.appendChild(todoLi);
          }
        },
        createDeleteButton: function(){
          var deleteButton = document.createElement('button');
          deleteButton.textContent = 'Delete';
          deleteButton.className = 'deleteButton';
          return deleteButton;
        },
        setupEventListeners: function(){
          var todosUl = document.querySelector('ul');
          todosUl.addEventListener('click', function(event){
            //console.log(event.target.parentNode.id);
            var elementClicked = event.target;
            if (elementClicked.className === 'deleteButton')
            {
              handlers.deleteTodo(parseInt(elementClicked.parentNode.id));
            }
          });
        }
      };

      view.setupEventListeners();

  </script>
</body>
</html>